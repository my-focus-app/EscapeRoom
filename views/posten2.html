<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Escape Room: Die verschwundene Pr√ºfung</title>
  <link rel="stylesheet" href="/css/style.css">
</head>
<body>
  <header>Escape Room: Die verschwundene Pr√ºfung</header>
  <main>
    <h1>Posten 2</h1>
    <section class="story" data-aos="fade-up">
      <p>In der folgenden Morsecode-Zeile stecken drei deutsche Zahlw√∂rter.
        Entschl√ºsselt sie und z√§hlt, wie viele Buchstaben jedes Wort hat.
        üîì Die Anzahl Buchstaben pro Wort ergibt die 3-stellige Kombination f√ºr das Schloss.
      </p>
      <p>Morsecode: --.. .-- .. . / ... . -.-. .... ... / ... ..- .--.</p>
      <p>Tipp: Nutzt ein Morsecode-Alphabet oder den Online-√úbersetzer</p>
    </section>  
    <input type="text" id="answer" placeholder="123">
    <button id="validateButton" onclick="checkAnswer()">Best√§tigen</button>
    <p id="message"></p>
  </main>

  <script>
    let attempts = 0;
    const maxAttempts = 3;
    const lockDuration = 15000; // 15 secondes

    function checkAnswer() {
      const answer = document.getElementById('answer').value;
      const message = document.getElementById('message');
      const button = document.getElementById('validateButton');

      if (attempts >= maxAttempts) {
        message.textContent = "Sie sind gesperrt. Bitte warten Sie 15 Sekunden...";
        return;
      }

      if (answer.trim() === "456") {
        message.textContent = "‚úÖ Bravo! Deine Zahl ist: 456";
        message.style.color = "lightgreen";
        document.getElementById('answer').disabled = true;
        button.disabled = true;

        // Notifie le serveur
        fetch('/progress/posten2', { method: 'POST' })
      } else {
        attempts++;
        if (attempts >= maxAttempts) {
          message.textContent = "üö´ Zu viele Fehler! F√ºr 15 Sekunden gesperrt.";
          message.style.color = "red";
          button.disabled = true;
          setTimeout(() => {
            attempts = 0;
            message.textContent = "Sie k√∂nnen es noch einmal versuchen.";
            button.disabled = false;
          }, lockDuration);
        } else {
          message.textContent = `Eine falsche Antwort. Versuch ${attempts}/${maxAttempts}.`;
          message.style.color = "orange";
        }
      }
    }

    setInterval(() => {
    fetch('/api/status')
      .then(res => res.json())
      .then(data => {
        if (data.timeLeft !== null && data.timeLeft <= 0) {
          window.location.href = '/results';
        }
      });
  }, 3000);
  </script>
</body>
</html>